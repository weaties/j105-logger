# Statement of Work — External Penetration Test
## J105 Sailing Data Logger System ("corvopi")

**Document version:** 1.0
**Prepared by:** Owner / weaties
**Date:** 2026-03-01
**Classification:** Confidential

---

## 1. Engagement Overview

The owner of the J105 sailing data logger system ("Client") requests an external penetration
test of the `corvopi` Raspberry Pi and its associated web services. The system is a
privately-operated sailing instrumentation device that logs NMEA 2000 data from a B&G instrument
network, records audio, and provides a web interface for race management. It is exposed to the
public internet via Tailscale Funnel.

The purpose of this engagement is to independently validate the findings of an internal security
audit (dated 2026-03-01) and identify any additional vulnerabilities before planned hardening work.

---

## 2. Scope

### 2.1 In-Scope Targets

| Target | Description | Access Method |
|--------|-------------|---------------|
| `https://corvopi.taileb1513.ts.net` | J105 web UI (port 3002 proxied via Tailscale Funnel) | Public internet |
| `https://corvopi.taileb1513.ts.net/grafana/` | Grafana dashboards (port 3001 proxied) | Public internet |
| `https://corvopi.taileb1513.ts.net/signalk/` | Signal K server (port 3000 proxied) | Public internet |
| `corvopi` host — OS layer | Raspberry Pi 5, Debian 13, kernel 6.12.47 | Authenticated SSH session (credentials provided) |
| Local services on `corvopi` | InfluxDB :8086, Signal K :3000, NMEA TCP :10110 | Via SSH tunnel |

**Tailscale network access:** The tester will be added to the `weaties@` Tailscale tailnet for
the duration of the engagement. Tailscale IP: `100.122.21.5`.

### 2.2 Out-of-Scope

- Tailscale infrastructure itself (Tailscale Inc. systems)
- Any external third-party services (Open-Meteo, NOAA CO-OPS, YouTube, Hugging Face)
- Physical hardware attacks (the device is on a boat; physical access is not granted)
- The Tailscale account management plane (admin.tailscale.com)
- Denial-of-service attacks that would disrupt sailing operations
- Social engineering of the device owner

### 2.3 Authorization Statement

Testing is authorized by the device owner (`weaties`) for the target systems listed in §2.1.
No third-party infrastructure is targeted. The tester must not pivot to any system reachable
from `corvopi` beyond the scope listed above.

---

## 3. Test Objectives

### 3.1 Primary Objectives

1. **Confirm or refute** the critical finding that `AUTH_DISABLED=true` with Tailscale Funnel
   provides unauthenticated access to all application data and write operations from the internet.

2. **Assess the attack surface** of the three publicly-exposed services (j105 web app, Grafana,
   Signal K) for web application vulnerabilities including but not limited to:
   - Authentication bypass and session management weaknesses
   - Injection (SQL, command, SSTI)
   - Broken access control (IDOR, privilege escalation within the app)
   - File inclusion / path traversal (particularly `GET /notes/{path}` and audio download endpoints)
   - CSRF on state-changing endpoints (race start/stop, crew modification, boat registry)
   - Sensitive data exposure (credentials in responses, verbose errors)
   - Security misconfiguration (CORS, missing security headers, TLS issues)

3. **Evaluate host-level hardening** via the authenticated SSH session:
   - Sudo privilege escalation paths
   - SUID/SGID binary exploitation
   - Weak file permissions (`.env`, SSH keys, systemd unit files)
   - Credential exposure (stored WiFi PSK, InfluxDB token, session tokens in DB)
   - Local service attack surface (InfluxDB, CUPS, rpcbind, Avahi)

4. **Evaluate network exposure** from both the internet (Tailscale Funnel) and local
   network perspectives:
   - Services binding on all interfaces vs. localhost
   - Firewall rule effectiveness
   - NMEA TCP and Signal K WebSocket data leakage

### 3.2 Secondary Objectives

- Assess the Signal K server for known CVEs or misconfigurations specific to marine
  instrument networks (unauthorized PUT/POST to navigation paths)
- Assess Grafana for CVEs relevant to version in use; test anonymous Viewer role escalation
- Review InfluxDB 2.7.11 for known vulnerabilities
- Assess the FastAPI/Python application for logic flaws specific to the race management workflow

---

## 4. Test Methodology

### Phase 1 — Reconnaissance (unauthenticated, external)
- DNS enumeration, certificate transparency log review for `taileb1513.ts.net`
- Fingerprint TLS configuration and cipher suites on Funnel endpoint
- HTTP banner grabbing and technology fingerprinting (server, framework, versions)
- Crawl and enumerate all publicly-reachable endpoints
- Review public Signal K API: test unauthenticated read of all data paths, WebSocket stream

### Phase 2 — Unauthenticated Web Application Testing
- Test all API endpoints accessible without authentication:
  - `GET /api/sessions`, `GET /api/state`, `GET /api/instruments`, `GET /api/polar/current`
  - `GET /notes/{path}` — attempt path traversal
  - `GET /api/audio/{id}/download` and `/stream` — IDOR testing (enumerate session IDs)
  - `GET /api/races/{id}/export.{fmt}` — IDOR and injection in format parameter
  - `GET /api/grafana/annotations`, `GET /api/system-health`
- Test write endpoints (with `AUTH_DISABLED=true` scenario): race start/stop, crew, notes, boats
- Test for CSRF: confirm presence/absence of CSRF tokens on state-changing POSTs
- Test Grafana anonymous Viewer for privilege escalation to Editor/Admin
- Test Signal K unauthenticated write requests to navigation paths

### Phase 3 — Authenticated Web Application Testing
*(After AUTH_DISABLED is set to false and a test account is provisioned)*
- Role escalation: test whether a `viewer` role can reach `crew` or `admin` endpoints
- Invite token security: entropy, expiry, single-use enforcement
- Session cookie security: flags (`HttpOnly`, `Secure`, `SameSite`), entropy, fixation
- IDOR: access race/audio/notes data belonging to sessions the test user did not create
- Admin endpoints: `/admin/users`, `/admin/boats` — test from viewer/crew accounts

### Phase 4 — Authenticated Host Assessment
*(Via provided SSH credentials for the `weaties` account)*
- Enumerate sudo rules and test privilege escalation to root
- Review SUID binaries for known exploits (`pkexec` PwnKit family, `ntfs-3g`, `pppd`)
- Review stored credentials: `.env`, NetworkManager PSK, InfluxDB token, SSH keys
- Assess local services: InfluxDB, CUPS, rpcbind, NFS stack
- Review systemd service unit security (missing `ProtectSystem`, `NoNewPrivileges`, etc.)
- Test Signal K `set-system-time` plugin for privilege abuse
- Review Python application source for code-level vulnerabilities

### Phase 5 — Reporting
- Compile findings with CVSS v3.1 scores
- Map to OWASP Top 10 (2021) and CWE identifiers where applicable
- Provide proof-of-concept reproduction steps for each finding
- Prioritised remediation recommendations

---

## 5. Credentials and Access Provided to Tester

| Credential | Value / Method |
|------------|----------------|
| SSH user | `weaties` (key-based; tester to provide their public key for addition to `authorized_keys`) |
| SSH host | `corvopi.taileb1513.ts.net` or `100.122.21.5` (via Tailscale) |
| Tailscale invite | To be sent via Tailscale admin panel before test start |
| j105 test account | Admin-role invite link to be generated at test start |
| Grafana admin | To be configured before test (currently no admin login available) |
| InfluxDB token | Full token in `.env`; tester may read directly via SSH |

**Note on current state:** At the time of testing, `AUTH_DISABLED=true` may still be set.
The tester should document findings in both the current (auth disabled) and hardened (auth
enabled) states as directed by the client.

---

## 6. Rules of Engagement

1. Testing window: to be agreed (recommend off-hours to minimise impact on active sailing sessions)
2. **Do not delete** any SQLite database rows, WAV audio files, or photo notes — the data
   represents real sailing race history
3. **Do not push** code to the GitHub repository (`weaties/j105-logger`)
4. **Do not pivot** from `corvopi` to other devices on the Tailscale tailnet
   (macbook-pro, blueflowers, ipad-pro) — test only corvopi
5. Stop and notify the client immediately if access to Tailscale infrastructure
   (beyond the device) appears possible
6. Avoid sustained load testing that could degrade the CAN bus / NMEA 2000 instrument reading;
   a brief denial-of-service test on the web service is acceptable with advance notice
7. All activity must be logged; provide raw tool output as appendices to the report

---

## 7. Deliverables

| Deliverable | Format | Due |
|-------------|--------|-----|
| Findings summary (pre-report) | Email / Slack | Within 24 h of test completion |
| Full penetration test report | PDF | Within 5 business days of test completion |
| Proof-of-concept scripts | ZIP attached to report | Same as report |
| Retest (if requested) | — | After client applies remediations |

### Report Minimum Contents

- Executive summary (non-technical)
- Scope, methodology, and timeline
- Finding detail for each vulnerability:
  - Title, CVSS v3.1 base score, CWE ID
  - Description and business impact
  - Reproduction steps (with screenshots or terminal output)
  - Remediation recommendation
- Risk matrix / finding index
- Appendix: raw tool output

---

## 8. System Context for the Tester

### Technology Stack

| Component | Technology | Version |
|-----------|------------|---------|
| OS | Debian GNU/Linux 13 (Trixie) | kernel 6.12.47+rpt-rpi-2712 |
| Web app | Python 3.12, FastAPI, uvicorn | see pyproject.toml |
| Database | SQLite (aiosqlite) | schema v16 |
| Instrument server | Signal K Server (Node.js) | 2.22.1 |
| Time-series DB | InfluxDB | 2.7.11 |
| Dashboards | Grafana | installed via apt |
| Tunnel | Tailscale Funnel | — |
| Hardware | Raspberry Pi 5 (aarch64) | — |

### Key Application Endpoints (j105 web app, port 3002)

**Always public (no auth even when AUTH_DISABLED=false):**
- `GET /healthz`
- `GET /login`, `POST /login`, `POST /logout`
- `GET /notes/{path}` ← intended to require auth but currently bypassed

**Documented as read-only (no `require_auth` Depends; protected by middleware only):**
- `GET /api/state`, `GET /api/instruments`, `GET /api/polar/current`
- `GET /api/sessions`, `GET /api/races`, `GET /api/races/{id}/crew`
- `GET /api/sailors/recent`, `GET /api/notes/settings-keys`
- `GET /api/sessions/{id}/videos`, `GET /api/videos/redirect`
- `GET /api/grafana/annotations`, `GET /api/system-health`
- `GET /api/audio/{id}/download`, `GET /api/audio/{id}/stream`
- `GET /api/audio/{id}/transcript`
- `GET /api/races/{id}/export.{fmt}` — CSV, GPX, JSON

**Write endpoints requiring `crew` role:**
- `POST /api/races/start`, `POST /api/races/{id}/end`
- `POST /api/races/{id}/debrief/start`, `POST /api/debrief/stop`
- `POST /api/event`, `POST /api/races/{id}/crew`
- `POST /api/boats`, `PATCH /api/boats/{id}`, `DELETE /api/boats/{id}`
- `POST /api/sessions/{id}/results`, `DELETE /api/results/{id}`
- `POST /api/sessions/{id}/notes`, `POST /api/sessions/{id}/notes/photo`
- `DELETE /api/notes/{id}`
- `POST /api/sessions/{id}/videos`, `PATCH /api/videos/{id}`, `DELETE /api/videos/{id}`
- `POST /api/sails`, `PATCH /api/sails/{id}`, `PUT /api/sessions/{id}/sails`
- `POST /api/audio/{id}/transcribe`

**Admin-only endpoints:**
- `GET /admin/users`, `POST /admin/users/invite`
- `PUT /admin/users/{id}/role`, `DELETE /admin/sessions/{id}`
- `GET /admin/boats`

### Known Pre-Existing Audit Findings

The following were identified in the internal audit and should be validated/exploited:
- F-01: `AUTH_DISABLED=true` — confirm full write access from public internet
- F-02: `NOPASSWD: ALL` sudo — demonstrate root escalation
- F-03: World-readable `.env` — confirm credential extraction
- F-05: Signal K no auth — confirm unauthenticated write requests
- F-06: Grafana anon Viewer — attempt role escalation
- F-08: `/notes/` auth bypass — confirm path traversal and IDOR on photo notes

---

## 9. Point of Contact

**Client contact:** weaties (device owner)
**Communication channel:** to be agreed
**Escalation for production impact:** contact immediately via phone/SMS if any action risks
corrupting the SQLite database or disrupting the CAN bus interface

---

*This Statement of Work constitutes authorization for the security assessment described above,
limited to the systems and scope defined in §2.*
